---
import Link from "../Link.astro";
import Button from "../Button.astro";

const posts = await Astro.glob('../../pages/posts/*.md');

const sortedPosts = posts.sort((a, b) => {
  const dateA = new Date(a.frontmatter.pubDate);
  const dateB = new Date(b.frontmatter.pubDate);
  return dateB.getTime() - dateA.getTime();
}).slice(0, 3);

function formatDate(dateString: string): string {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
}
---

<section>
    <h2 class="text-2xl font-bold mb-8">blog</h2>

    <div class="mx-auto grid max-w-2xl grid-cols-1 gap-x-8 gap-y-16 lg:mx-0 lg:max-w-none lg:grid-cols-3">
      {sortedPosts.map((post) => (
        <article class="group flex max-w-xl flex-col items-start justify-between text-primary/80 hover:text-secondary transition-colors">
          <div class="flex items-center gap-x-4 text-xs">
            <time datetime={post.frontmatter.pubDate}>
              {formatDate(post.frontmatter.pubDate)}
            </time>
          </div>
          <div class="group relative">
            <h3 class="mt-3 font-semibold text-primary group-hover:text-secondary transition-colors">
              <a href={post.url}>
                <span class="absolute inset-0"></span>
                {post.frontmatter.title}
              </a>
            </h3>
            <p class="mt-5 line-clamp-3 text-sm font-light ">{post.frontmatter.description}</p>
          </div>
        </article>
      ))}
    </div>

    <div class="w-full flex justify-center mt-8">
        <Button href="/blog" variant="secondary">
            view all
        </Button>
    </div>
</section> 